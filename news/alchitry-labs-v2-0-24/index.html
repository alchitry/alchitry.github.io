<!DOCTYPE html>
<html lang="en" dir="auto">
<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Alchitry Labs V2.0.24 - Negative Indices</title>


<meta name="keywords" content="keyword1, keyword2, keyword3">



<meta name="description" content="">



<meta name="author" content="Justin Rajewski">


<link rel="canonical" href="https:&#x2F;&#x2F;alchitry.com&#x2F;news&#x2F;alchitry-labs-v2-0-24&#x2F;">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://alchitry.com/css/styles.css">
<link rel="stylesheet" href="https://alchitry.com/css/override.css">


<link rel="icon" href="https://alchitry.com/favicon.svg" type="image/svg+xml">
<link rel="icon" type="image/png" sizes="16x16" href="https://alchitry.com/favicon_16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://alchitry.com/favicon_32.png">
<link rel="apple-touch-icon" href="https://alchitry.com/apple-touch-icon.png"><!-- 180×180 -->
<meta name="theme-color" content="#333333">


<link rel="alternate" type="application/atom+xml" title="RSS" href="https://alchitry.com/atom.xml">


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
    
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
    
</noscript>



    
</head>
<body class=" dark" id="top">
    
    
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"/>

<header class="header">

    <nav class="nav">
        <div class="logo">
            <a href="https:&#x2F;&#x2F;alchitry.com" accesskey="h" title="Alchitry (Alt + H)"><img src="https://alchitry.com/alchitry.svg"
                                                         alt="Alchitry"
                                                         aria-label="Alchitry">
            </a>
        </div>
        
        <div id="nav-search">
            <ul id="menu" class="desktop-nav">
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
                        <span>Boards</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
                        <span>News</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
                        <span>Tutorials</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
                        <span>Alchitry Labs</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
                        <span>Forum</span>
                        
                    </a>
                </li>
                
            </ul>
            <div class="search-container">
                <input class="search" type="search" placeholder="Search" autocomplete="off">
                <span class="material-symbols-outlined search-icon">search</span>

                <div class="search-results">
                    <div class="search-results__items"></div>
                </div>
            </div>
        </div>
        <div id="overlayNavOpen">
            <span onclick="openNav()" class="material-symbols-outlined">menu</span>
        </div>
        
    </nav>
</header>


<div id="overlayNav" class="overlay">
    <div class="overlay-header">
        <div class="search-container">
            <input class="search" type="search" placeholder="Search" autocomplete="off">
            <span class="material-symbols-outlined search-icon">search</span>

            <div class="search-results">
                <div class="search-results__items"></div>
            </div>
        </div>
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    </div>

    <div class="overlay-content">
        
        
        
        <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
            <span>Boards</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
            <span>News</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
            <span>Tutorials</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
            <span>Alchitry Labs</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
            <span>Forum</span>
            
        </a>
        
    </div>
</div>

    
    <main class="main">
        
<article class="post-single">
    <header class="post-header">
        <div class="breadcrumbs">
            
            <div class="breadcrumb-container">
                <a class="breadcrumb-path" href="/">Home</a>
                
                
                
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;news&#x2F;">News</a>
                
                <span class="breadcrumb-separator">»</span>
                <a class="breadcrumb-path active" href="https:&#x2F;&#x2F;alchitry.com&#x2F;news&#x2F;alchitry-labs-v2-0-24&#x2F;">Alchitry Labs V2.0.24 - Negative Indices</a>
            </div>
            
        </div>
        <h1 class="post-title">Alchitry Labs V2.0.24 - Negative Indices</h1>
        
        
        <div class="post-meta">
            
















<span>2025-01-24</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Justin Rajewski

            &nbsp;|&nbsp;&nbsp;<a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry&#x2F;alchitry.github.io&#x2F;tree&#x2F;master/content/news&#x2F;alchitry-labs-v2.0.24.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

        </div>
        
    </header>

    
    

<div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner">
            <ul>
                
                <li>
                    <a href="#new-components" aria-label="New Components">New Components</a>
                    
                </li>
                
                <li>
                    <a href="#asynchronous-resets" aria-label="Asynchronous Resets">Asynchronous Resets</a>
                    
                </li>
                
                <li>
                    <a href="#negative-indices" aria-label="Negative Indices">Negative Indices</a>
                    
                </li>
                
                <li>
                    <a href="#updates" aria-label="Updates">Updates</a>
                    
                </li>
                
            </ul>
        </div>
    </details>
</div>


    

    
    <div class="post-content">
        <p><a href="https://alchitry.com/alchitry-labs/">Alchitry Labs V2.0.24-BETA</a> is now out bringing many updates from the last blog post on 2.0.21.</p>
<span id="continue-reading"></span><h1 id="new-components">New Components<a class="anchor" aria-hidden="true" href="#new-components" hidden="">#</a>
</h1>
<p>Alchitry Labs now has a few new components baked in to support the <a href="https://shop.alchitry.com/products/alchitry-ft-v2">Ft</a>,
<a href="https://shop.alchitry.com/products/alchitry-ft-v2?variant=48644641161493">Ft+</a>, and <a href="https://shop.alchitry.com/products/alchitry-hd">Hd</a>.</p>
<p>Most importantly, constraint files for these boards are now in the <em>Components Library</em>.
This also includes the much overdue constraint file for the original Ft.</p>
<p>A new <code class ="language-acf" data-lang="acf"><span>ft</span></code> component was added under the <em>Interfaces</em> category of the <em>Components Library</em>.
This component supports the Ft and Ft+ with both read and write operations.
It's a great starting point for any project using either of these boards.</p>
<p>It handles switching between reads and writes automatically.
The interface to the rest of your design is simply two FIFOs.
One for sending data and one for receiving data.</p>
<p>Parameters can be set to prioritize sending or receiving to ensure you don't accidentally starve out one direction.</p>
<p>A tutorial showing how to design an interface and actually get data off is planned.</p>
<p>The <code class ="language-acf" data-lang="acf"><span>spi_controller</span></code> and <code class ="language-acf" data-lang="acf"><span>spi_peripheral</span></code> components also got a facelift.
The <code class ="language-acf" data-lang="acf"><span>spi_peripheral</span></code> has improved synchronization of its inputs and now provides a clock cycle to use the last
received byte to influence the next byte to send.</p>
<p>The <code class ="language-acf" data-lang="acf"><span>spi_peripheral</span></code> is great when bus speeds are fairly low (&lt;1/16th the system clock).
However, sometimes you need a faster bus.
This is where the new <code class ="language-acf" data-lang="acf"><span>spi_fast_peripheral</span></code> comes in.</p>
<p>This component supports bus speeds right up to the system clock.
Being able to handle this speed has a few tradeoffs over the standard version.
First, the byte to be sent out on the next cycle is read during the previous byte.
This means that the first byte of a transaction is always 0 and a dummy byte must be inserted if you need to respond
to a previous byte.</p>
<p>A typical transaction usually starts with the controller sending a command followed by the peripheral responding.
A dummy byte is required between the command and the response to give it type to get the byte received across clock
domains and the byte to send back across.</p>
<h1 id="asynchronous-resets">Asynchronous Resets<a class="anchor" aria-hidden="true" href="#asynchronous-resets" hidden="">#</a>
</h1>
<p>When writing the <code class ="language-acf" data-lang="acf"><span>spi_fast_peripheral</span></code>, I ran into a fairly unique scenario where I needed to reset some <code class ="language-acf" data-lang="acf"><span>dff</span></code> when
there wasn't a clock present.
This means I needed to use an asynchronous reset.
Typically, you don't want to use these in an FPGA because they can lead to timing issues if you aren't careful about
how the reset edges will line up with the clock edge.
This issue is exactly why the <code class ="language-acf" data-lang="acf"><span>reset_conditioner</span></code> is used to synchronize the input from the reset button to create a
synchronous reset.</p>
<p>Sometimes, there is no way around needed an asynchronous reset though and there was no way to implement one in Lucid.
This lead me to add the <code class ="language-acf" data-lang="acf"><span>arst</span></code> signal to <code class ="language-acf" data-lang="acf"><span>dff</span></code>.
This signal works identically to <code class ="language-acf" data-lang="acf"><span>rst</span></code> except it is implemented as an asynchronous reset instead of synchronous.
You can only provide <code class ="language-acf" data-lang="acf"><span>rst</span></code> or <code class ="language-acf" data-lang="acf"><span>arst</span></code> for any <code class ="language-acf" data-lang="acf"><span>dff</span></code>, not both.</p>
<p>An asynchronous reset will cause the value of the <code class ="language-acf" data-lang="acf"><span>dff</span></code> to immediately change to its reset value.
A synchronous reset waits for the next rising edge of the clock.</p>
<p>In the case of the <code class ="language-acf" data-lang="acf"><span>spi_fast_periperal</span></code>, an asynchronous reset was used to reset some <code class ="language-acf" data-lang="acf"><span>dff</span></code> that are clocked off the 
bus clock when the chip select line is high.
During that time, there typically aren't any clock edges so a synchronous reset would never actually reset.</p>
<p>While this is now available, you should almost always opt for just using <code class ="language-acf" data-lang="acf"><span>rst</span></code> in your design unless you have a really
good reason not to.</p>
<h1 id="negative-indices">Negative Indices<a class="anchor" aria-hidden="true" href="#negative-indices" hidden="">#</a>
</h1>
<p>While <code class ="language-acf" data-lang="acf"><span>arst</span></code> is a feature you generally won't use, negative indices are something I think you'll use all the time.</p>
<p>If you've ever used Python, you've likely encountered negative indices.
This is when indices of an array <em>wrap around</em> 0 instead of being invalid.
That means that index -1 is actually the highest index.</p>
<p>There are many places where I'll have some signal like <code class ="language-acf" data-lang="acf"><span>my_really_long_signal_name</span></code> and I'll need to access its MSB
(most significant bit).
If the size of the signal could change, I would have had to write 
<code class ="language-acf" data-lang="acf"><span>my_really_long_signal_name</span><span style="color:#ed4343;">[</span><span>$width</span><span style="color:#ed4343;">(</span><span>my_really_long_signal_name</span><span style="color:#ed4343;">)-</span><span style="color:#a269dc;">1</span><span style="color:#ed4343;">]</span></code> to get the MSB.
With negative indices, I can now simply write <code class ="language-acf" data-lang="acf"><span>my_really_long_signal_name</span><span style="color:#ed4343;">[-</span><span style="color:#a269dc;">1</span><span style="color:#ed4343;">]</span></code> and the tools will figure it out.</p>
<p>Essentially, if the index is negative, it is added to the width of the signal.
That means -1 is the MSB, -2 is one bit down from the MSB, etc.</p>
<p>You can use this anywhere you would have used an index before including in range selectors.
For example, <code class ="language-acf" data-lang="acf"><span>my_really_long_signal_name</span><span style="color:#ed4343;">[-</span><span style="color:#a269dc;">1</span><span style="color:#ed4343;">:-</span><span style="color:#a269dc;">2</span><span style="color:#ed4343;">]</span></code> would select the top most two bits.</p>
<p>Hopefully you'll find this as helpful as I do!</p>
<h1 id="updates">Updates<a class="anchor" aria-hidden="true" href="#updates" hidden="">#</a>
</h1>
<p>Some major work went into updating things to work with the latest Compose (GUI) version.</p>
<p>It seems like they did a lot of work with Compose to improve its performance and only redraw/compose things that fully 
need it but that cause some issues in our custom code editor.
I think it got it all working but if you notice any weird UI artifacts, post 
<a href="https://github.com/alchitry/Alchitry-Labs-V2/issues">an issue on GitHub</a>.</p>
<p>A lot of work also went into creating a new workflow for working with the open source <a href="https://github.com/YosysHQ">YosysHQ</a>
projects.
This trip down this rabbit hole was started from an issue raised where <code class ="language-acf" data-lang="acf"><span>yosys</span><span style="color:#ed4343;">-</span><span>abc</span></code> was creating access denied errors 
when installed on Windows.
After figuring out the issue, I ended up <a href="https://github.com/alchitry/oss-cad-suite-build">forking the build scrips</a>
that YosysHQ uses to build specifically for Alchitry Labs.
With this, it'll be easy to keep the open source tools bundled with Alchitry Labs up to date.</p>
<p>Running the gradle task <code class ="language-acf" data-lang="acf"><span>download</span><span style="color:#ed4343;">-</span><span>oss</span><span style="color:#ed4343;">-</span><span>cad</span><span style="color:#ed4343;">-</span><span>suite</span></code> fetches the latest build and adds it to Alchitry Labs.</p>
<p>Thanks for reading and I hope you enjoy the new updates!</p>

    </div>
    

    <footer class="post-footer">
        

        
        



<nav class="paginav">
    
        
        <a class="prev" href="https:&#x2F;&#x2F;alchitry.com&#x2F;news&#x2F;alchitry-labs-v2-0-21-acf&#x2F;">
            <span class="title">« Prev</span>
            <br>
            <span>Alchitry Labs V2.0.21 - Alchitry Constraints Updated</span>
        </a>
        
        
    
</nav>


        
        
    </footer>

</article>

    </main>
    
    <footer class="footer">
    <div>
        <div class="social-icons">
    
    <a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="GitHub">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;youtube.com&#x2F;c&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="YouTube">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z">
    </path>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;atom.xml" target="_blank" rel="noopener noreferrer me" title="RSS">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>


    </a>
    
</div>

        <span>&copy; 2025 <a href="https:&#x2F;&#x2F;alchitry.com">Alchitry</a></span>
    </div>
</footer>


<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z"/>
    </svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>


<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>


<script>
    /* Open */
    function openNav() {
        document.getElementById("overlayNav").style.display = "block";
    }

    /* Close */
    function closeNav() {
        document.getElementById("overlayNav").style.display = "none";
    }
</script>



<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
            }
            ;
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            // td containing LineNos
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            // table containing LineNos and code
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            // code blocks not having highlight as parent class
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script type="text/javascript" src="https://alchitry.com/elasticlunr.min.js"></script>
<script type="text/javascript" src="https://alchitry.com/search.js"></script>
    
</body>
</html>
