<!DOCTYPE html>
<html lang="en" dir="auto">
<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Analog Inputs</title>


<meta name="keywords" content="keyword1, keyword2, keyword3">



<meta name="description" content="">



<meta name="author" content="Justin Rajewski">


<link rel="canonical" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;lucid_v1&#x2F;mojo&#x2F;analog-inputs&#x2F;">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
</script>
<script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
</script>

<link rel="stylesheet" href="https://alchitry.com/styles.css">
<link rel="stylesheet" href="https://alchitry.com/override.css">

<link rel="icon" href="https://alchitry.com/favicon.svg" type="image/svg+xml">
<link rel="icon" type="image/png" sizes="16x16" href="https://alchitry.com/favicon_16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://alchitry.com/favicon_32.png">
<link rel="apple-touch-icon" href="https://alchitry.com/apple-touch-icon.png"><!-- 180×180 -->
<meta name="theme-color" content="#333333">


<link rel="alternate" type="application/atom+xml" title="RSS" href="https://alchitry.com/atom.xml">


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
    
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
    
</noscript>



    
</head>
<body class=" dark" id="top">
    
    
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"/>

<header class="header">

    <nav class="nav">
        <div class="logo">
            <a href="https:&#x2F;&#x2F;alchitry.com" accesskey="h" title="Alchitry (Alt + H)"><img src="https://alchitry.com/alchitry.svg"
                                                         alt="Alchitry"
                                                         aria-label="Alchitry">
            </a>
        </div>
        
        <div id="nav-search">
            <ul id="menu" class="desktop-nav">
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
                        <span>Boards</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
                        <span>News</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
                        <span>Tutorials</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
                        <span>Alchitry Labs</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
                        <span>Forum</span>
                        
                    </a>
                </li>
                
            </ul>
            <div class="search-container">
                <input class="search" type="search" placeholder="Search" autocomplete="off">
                <span class="material-symbols-outlined search-icon">search</span>

                <div class="search-results">
                    <div class="search-results__items"></div>
                </div>
            </div>
        </div>
        <div id="overlayNavOpen">
            <span onclick="openNav()" class="material-symbols-outlined">menu</span>
        </div>
        
    </nav>
</header>


<div id="overlayNav" class="overlay">
    <div class="overlay-header">
        <div class="search-container">
            <input class="search" type="search" placeholder="Search" autocomplete="off">
            <span class="material-symbols-outlined search-icon">search</span>

            <div class="search-results">
                <div class="search-results__items"></div>
            </div>
        </div>
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    </div>

    <div class="overlay-content">
        
        
        
        <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
            <span>Boards</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
            <span>News</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
            <span>Tutorials</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
            <span>Alchitry Labs</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
            <span>Forum</span>
            
        </a>
        
    </div>
</div>

    
    <main class="main">
        
<article class="post-single">
    <header class="post-header">
        <div class="breadcrumbs">
            
            <div class="breadcrumb-container">
                <a class="breadcrumb-path" href="/">Home</a>
                
                
                
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;">Tutorials</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;">Archive</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;lucid_v1&#x2F;">Lucid V1</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;lucid_v1&#x2F;mojo&#x2F;">Mojo</a>
                
                <span class="breadcrumb-separator">»</span>
                <a class="breadcrumb-path active" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;lucid_v1&#x2F;mojo&#x2F;analog-inputs&#x2F;">Analog Inputs</a>
            </div>
            
        </div>
        <h1 class="post-title">Analog Inputs</h1>
        
        
        <div class="post-meta">
            













7 min&nbsp;·&nbsp;Justin Rajewski

            &nbsp;|&nbsp;&nbsp;<a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry&#x2F;alchitry.github.io&#x2F;tree&#x2F;master/content/tutorials&#x2F;archive&#x2F;lucid_v1&#x2F;mojo&#x2F;analog-inputs.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

        </div>
        
    </header>

    
    

<div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner">
            <ul>
                
                <li>
                    <a href="#reading-a-channel" aria-label="Reading a Channel">Reading a Channel</a>
                    
                    <ul>
                    
                        <li>
                            <a href="#adc-to-leds" aria-label="ADC to LEDs">ADC to LEDs</a>
                            
                        </li>
                    
                        <li>
                            <a href="#connect-it-up" aria-label="Connect it Up">Connect it Up</a>
                            
                        </li>
                    
                    </ul>
                    
                </li>
                
                <li>
                    <a href="#multiple-channels" aria-label="Multiple Channels">Multiple Channels</a>
                    
                </li>
                
            </ul>
        </div>
    </details>
</div>


    

    
    <div class="post-content">
        <p>Welcome to the Analog Inputs Tutorial! In this tutorial, you will learn how to read the analog inputs on the Mojo. To demo this, we will modify the <em>AVR Interface Project</em> so that the analog values are displayed on the LEDs.</p>
<h2 id="reading-a-channel">Reading a Channel</h2>
<p>We will start off by first reading only the <em>A0</em> input and displaying its value on all eight LEDs.</p>
<p>First, make a new project based on the <em>AVR Interface Project</em>. This project already has the <em>avr_interface</em> module added and the basic connections wired up.</p>
<h3 id="adc-to-leds">ADC to LEDs</h3>
<p>We are going to create a new module named <strong>adc_to_leds</strong>. But before we do that, add the <em>Pulse Width Modulator</em> component to your project. It can be found under <em>LED Effects</em> in the <em>Component Selector</em>. We will be using this to fade the LEDs based on the voltage read.</p>
<p>With all the components we need added, create a new module named <strong>adc_to_leds</strong> and fill it with the following.</p>
<pre data-lang="lucid" style="background-color:#282828;color:#ffffff;" class="language-lucid "><code class ="language-lucid" data-lang="lucid"><span style="font-weight:bold;color:#faac1f;">module</span><span> adc_to_leds </span><span style="color:#ed4343;">(
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> clk</span><span style="color:#ed4343;">,               </span><span style="color:#969696;">// clock
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> rst</span><span style="color:#ed4343;">,               </span><span style="color:#969696;">// reset
</span><span>    </span><span style="color:#0a8dbf;">output</span><span> channel</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">4</span><span style="color:#ed4343;">],       </span><span style="color:#969696;">// channel we want to sample
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> sample</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">10</span><span style="color:#ed4343;">],        </span><span style="color:#969696;">// sample value
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> sample_channel</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">4</span><span style="color:#ed4343;">], </span><span style="color:#969696;">// channel the sample is from
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> new_sample</span><span style="color:#ed4343;">,        </span><span style="color:#969696;">// 1 = new sample
</span><span>    </span><span style="color:#0a8dbf;">output</span><span> leds</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">8</span><span style="color:#ed4343;">]           </span><span style="color:#969696;">// output to leds
</span><span>  </span><span style="color:#ed4343;">) {
</span><span> 
</span><span>  .clk</span><span style="color:#ed4343;">(</span><span>clk</span><span style="color:#ed4343;">),</span><span> .rst</span><span style="color:#ed4343;">(</span><span>rst</span><span style="color:#ed4343;">) {
</span><span>    pwm pwm</span><span style="color:#ed4343;">(#</span><span style="color:#d45ada;">WIDTH</span><span style="color:#ed4343;">(</span><span style="color:#a269dc;">10</span><span style="color:#ed4343;">));     </span><span style="color:#969696;">// 10bit PWM to show ADC value
</span><span>  </span><span style="color:#ed4343;">}
</span><span> 
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">always </span><span style="color:#ed4343;">{
</span><span>    channel </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">0</span><span style="color:#ed4343;">;             </span><span style="color:#969696;">// always read channel 0
</span><span> 
</span><span>    pwm.value </span><span style="color:#ed4343;">=</span><span> sample</span><span style="color:#ed4343;">;      </span><span style="color:#969696;">// set the PWM to the ADC sample value
</span><span>    pwm.update </span><span style="color:#ed4343;">=</span><span> new_sample</span><span style="color:#ed4343;">; </span><span style="color:#969696;">// update the PWM when we have new samples
</span><span> 
</span><span>    leds </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">8</span><span style="color:#ed4343;">x{</span><span>pwm.pulse</span><span style="color:#ed4343;">};    </span><span style="color:#969696;">// send PWM signal to all LEDs
</span><span>  </span><span style="color:#ed4343;">}
</span><span style="color:#ed4343;">}
</span></code></pre>
<p>The way the ADC interface works is that we specify a channel we want to sample on <em>channel</em>. Then when a new sample is ready, the <em>new_sample</em> signal will go high. This signals that <em>sample</em> and <em>sample_channel</em> have valid data. The signal <em>sample_channel</em> specifies which channel the sample came from. This is important because as you start switching the channel to sample from, you are not guaranteed that the next sample will come from the new channel if a sample was already being read from the old channel. In this particular case, we are only ever reading one channel so all the samples must have come from channel 0.</p>
<p>Note that the channel number corresponds to the analog input number. In other words, channel 0 is A0, channel 8 is A8, etc. If you set channel to an invalid number (like 15), the ADC is disabled and no channels are sampled. This is useful if you don't need the ADC running as it frees up the AVR to send and receive USB data faster.</p>
<p>The PWM module is pretty simple. Since we set the <em>WIDTH</em> to 10, we specify a 10 bit value on <em>pwm.value</em> and set <em>pwm.update</em> to 1 whenever there is a new value. The output, <em>pwm_pulse</em>, is then a PWM signal with a duty cycle of <em>pwm.value</em>/210.</p>
<p>Finally, we simply duplicate the pwm output to all LEDs.</p>
<h3 id="connect-it-up">Connect it Up</h3>
<p>We now need to add our new module to <em>mojo_top</em>.</p>
<pre data-lang="lucid" style="background-color:#282828;color:#ffffff;" class="language-lucid "><code class ="language-lucid" data-lang="lucid"><span>.rst</span><span style="color:#ed4343;">(</span><span>rst</span><span style="color:#ed4343;">){
</span><span>  </span><span style="color:#969696;">// the avr_interface module is used to talk to the AVR for access to the USB port and analog pins
</span><span>  avr_interface avr</span><span style="color:#ed4343;">;
</span><span> 
</span><span>  adc_to_leds adc</span><span style="color:#ed4343;">; </span><span style="color:#969696;">// reads the analog inputs and shows them on the LEDs
</span><span style="color:#ed4343;">}
</span></code></pre>
<p>We also need to connect it up.</p>
<pre data-lang="lucid" style="background-color:#282828;color:#ffffff;" class="language-lucid "><code class ="language-lucid" data-lang="lucid"><span style="color:#969696;">// connect the adc module
</span><span>avr.channel </span><span style="color:#ed4343;">=</span><span> adc.channel</span><span style="color:#ed4343;">;
</span><span>adc.sample </span><span style="color:#ed4343;">=</span><span> avr.sample</span><span style="color:#ed4343;">;
</span><span>adc.sample_channel </span><span style="color:#ed4343;">=</span><span> avr.sample_channel</span><span style="color:#ed4343;">;
</span><span>adc.new_sample </span><span style="color:#ed4343;">=</span><span> avr.new_sample</span><span style="color:#ed4343;">;
</span><span>led </span><span style="color:#ed4343;">=</span><span> adc.leds</span><span style="color:#ed4343;">;
</span></code></pre>
<p>Note that the lines where <em>avr.channel</em> and <em>led</em> were previously assigned should be removed.</p>
<p>You should be able to build the project and load it onto your Mojo. With the project loaded, if you take a potentiometer and connected one end to +V (3.3v), the other to gnd (0v), and the arm to <em>A0</em> then you should be able to use the potentiometer to control the brightness of the LEDs.</p>
<h2 id="multiple-channels">Multiple Channels</h2>
<p>This is super cool and all, but we have 8 inputs so it feels like a waste to only use one. Since there are conveniently 8 analog inputs and 8 LEDs, lets show each analog input on its own LED.</p>
<p>To do this we only need to change the <em>adc_to_leds</em> module.</p>
<pre data-lang="lucid" style="background-color:#282828;color:#ffffff;" class="language-lucid "><code class ="language-lucid" data-lang="lucid"><span style="font-weight:bold;color:#faac1f;">module</span><span> adc_to_leds </span><span style="color:#ed4343;">(
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> clk</span><span style="color:#ed4343;">,               </span><span style="color:#969696;">// clock
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> rst</span><span style="color:#ed4343;">,               </span><span style="color:#969696;">// reset
</span><span>    </span><span style="color:#0a8dbf;">output</span><span> channel</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">4</span><span style="color:#ed4343;">],       </span><span style="color:#969696;">// channel we want to sample
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> sample</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">10</span><span style="color:#ed4343;">],        </span><span style="color:#969696;">// sample value
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> sample_channel</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">4</span><span style="color:#ed4343;">], </span><span style="color:#969696;">// channel the sample is from
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> new_sample</span><span style="color:#ed4343;">,        </span><span style="color:#969696;">// 1 = new sample
</span><span>    </span><span style="color:#0a8dbf;">output</span><span> leds</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">8</span><span style="color:#ed4343;">]           </span><span style="color:#969696;">// output to leds
</span><span>  </span><span style="color:#ed4343;">) {
</span><span> 
</span><span>  </span><span style="color:#969696;">// This is used to convert 0 to 7 to its corresponding channel 0 to 1 and 4 to 9
</span><span>  </span><span style="color:#0a8dbf;">const </span><span style="color:#d45ada;">LED_TO_CHANNEL </span><span style="color:#ed4343;">= {</span><span style="color:#a269dc;">4d9</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d8</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d7</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d6</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d5</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d4</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d1</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d0</span><span style="color:#ed4343;">};
</span><span> 
</span><span>  </span><span style="color:#969696;">// This is used to convert the sample channel to the corresponding LED
</span><span>  </span><span style="color:#969696;">// Most channels are invalid and will never be seen so we use &#39;x&#39; as don&#39;t cares
</span><span>  </span><span style="color:#0a8dbf;">const </span><span style="color:#d45ada;">CHANNEL_TO_LED </span><span style="color:#ed4343;">= {</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d7</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d6</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d5</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d4</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d3</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d2</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4bx</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d1</span><span style="color:#ed4343;">,</span><span style="color:#a269dc;">4d0</span><span style="color:#ed4343;">};
</span><span> 
</span><span>  .clk</span><span style="color:#ed4343;">(</span><span>clk</span><span style="color:#ed4343;">),</span><span> .rst</span><span style="color:#ed4343;">(</span><span>rst</span><span style="color:#ed4343;">) {
</span><span>    pwm pwm</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">8</span><span style="color:#ed4343;">](#</span><span style="color:#d45ada;">WIDTH</span><span style="color:#ed4343;">(</span><span style="color:#a269dc;">10</span><span style="color:#ed4343;">));                           </span><span style="color:#969696;">// 10bit PWM to show ADC value
</span><span>    </span><span style="color:#0a8dbf;">dff</span><span> ch</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">4</span><span style="color:#ed4343;">];                                        </span><span style="color:#969696;">// channel counter
</span><span>  </span><span style="color:#ed4343;">}
</span><span> 
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">always </span><span style="color:#ed4343;">{
</span><span>    channel </span><span style="color:#ed4343;">= </span><span style="color:#d45ada;">LED_TO_CHANNEL</span><span style="color:#ed4343;">[</span><span>ch.q</span><span style="color:#ed4343;">];                   </span><span style="color:#969696;">// set the channel to sample
</span><span> 
</span><span>    pwm.value </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">8</span><span style="color:#ed4343;">x{{</span><span>sample</span><span style="color:#ed4343;">}};                         </span><span style="color:#969696;">// all PWM values are from sample
</span><span>    pwm.update </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">8b0</span><span style="color:#ed4343;">;                                 </span><span style="color:#969696;">// default to not updating
</span><span> 
</span><span>   </span><span style="color:#969696;">// when there is a new sample for our given channel
</span><span>   </span><span style="font-weight:bold;color:#0abfbf;">if </span><span style="color:#ed4343;">(</span><span>new_sample </span><span style="color:#ed4343;">&amp;&amp;</span><span> sample_channel </span><span style="color:#ed4343;">== </span><span style="color:#d45ada;">LED_TO_CHANNEL</span><span style="color:#ed4343;">[</span><span>ch.q</span><span style="color:#ed4343;">]) {  
</span><span>      pwm.update</span><span style="color:#ed4343;">[</span><span style="color:#d45ada;">CHANNEL_TO_LED</span><span style="color:#ed4343;">[</span><span>sample_channel</span><span style="color:#ed4343;">]] = </span><span style="color:#a269dc;">1</span><span style="color:#ed4343;">; </span><span style="color:#969696;">// update the corresponding PWM channel
</span><span>      ch.d </span><span style="color:#ed4343;">=</span><span> ch.q </span><span style="color:#ed4343;">+ </span><span style="color:#a269dc;">1</span><span style="color:#ed4343;">;                                </span><span style="color:#969696;">// increment the channel we are sampling
</span><span>      </span><span style="font-weight:bold;color:#0abfbf;">if </span><span style="color:#ed4343;">(</span><span>ch.q </span><span style="color:#ed4343;">== </span><span style="color:#a269dc;">7</span><span style="color:#ed4343;">)                                  </span><span style="color:#969696;">// there are only 8 channels (0 to 7)
</span><span>        ch.d </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">0</span><span style="color:#ed4343;">;                                     </span><span style="color:#969696;">// restart at 0
</span><span>    </span><span style="color:#ed4343;">}
</span><span> 
</span><span>    leds </span><span style="color:#ed4343;">=</span><span> pwm.pulse</span><span style="color:#ed4343;">;                                 </span><span style="color:#969696;">// send PWM signals to all LEDs
</span><span>  </span><span style="color:#ed4343;">}
</span><span style="color:#ed4343;">}
</span></code></pre>
<p>The analog input channels are slightly strange on the Mojo in that A2 and A3 don't exist. To compensate for this, we use the constants <em>LED_TO_CHANNEL</em> and <em>CHANNEL_TO_LED</em> to map from our LED indices (0 to 7) to the ADC channel indices. Notice that there are 16 possible values for the channel, but we are only using 8 so we filled the remaining slots with <em>4bx</em>. This is because these values should never be used anyways and it gives the tools freedom to choose whatever makes our design simplest.</p>
<p>Notice that we now have eight <em>pwm</em> modules as <em>pwm</em> is now an array. This is because we want a different PWM output for each of the eight LEDs.</p>
<p>Remember that the PWM modules only update their values when <em>update</em> is 1. This allows us to set all the modules to have the same <em>value</em> input and only set the corresponding module's <em>update</em> to be 1 when we have a new sample.</p>
<p>Line 26 has some interesting syntax. We are duplicating an array of sample 8 times. This builds a two dimensional array with dimensions of 8 by 10. If instead we simply did <em>8x{sample}</em> we would have a single dimensional array of 80 bits wide and the dimensions wouldn't match <em>pwm.value</em>. The reason this works is because <em>{sample}</em> is a 2D array with dimensions of 1 by 10. The <em>8x{}</em> part then duplicates the outermost dimension making it 8 by 10.</p>
<p>Each time a new sample comes in, we increment the <em>ch</em> counter. This is so that we continue to sample all the channels in a round-robin fashion.</p>
<p>If you now build and load your project, you should see all eight LEDs working independently. You can test each one by plugging in your potentiometer to each channel.</p>
<p>That's it for this tutorial. You should now know how to make use of the analog inputs on the Mojo. A good challenge would be to modify <em>adc_to_leds</em> so that instead of using PWM to display the analog values, you set a single LED on to show which channel has the largest value. For example, if <em>A1</em> has the highest value, then LED[1] should be lit and the rest should be off. You should have all the tools for this if you've followed the tutorials up to this point. If you need help you can always <a href="http://forum.alchitry.com/">visit our forum</a>.</p>

    </div>
    

    <footer class="post-footer">
        

        
        



<nav class="paginav">
    
        
        <a class="prev" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;lucid_v1&#x2F;mojo&#x2F;external-io&#x2F;">
            <span class="title">« Prev</span>
            <br>
            <span>External IO</span>
        </a>
        
        
        <a class="next" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;lucid_v1&#x2F;mojo&#x2F;servos&#x2F;">
            <span class="title">Next »</span>
            <br>
            <span>Servos</span>
        </a>
        
    
</nav>


        
        
    </footer>

</article>

    </main>
    
    <footer class="footer">
    <div>
        <div class="social-icons">
    
    <a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="GitHub">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;youtube.com&#x2F;c&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="YouTube">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z">
    </path>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;atom.xml" target="_blank" rel="noopener noreferrer me" title="RSS">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>


    </a>
    
</div>

        <span>&copy; 2026 <a href="https:&#x2F;&#x2F;alchitry.com">Alchitry</a></span>
    </div>
</footer>


<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#e3e3e3"><path d="M440-320h80v-168l64 64 56-56-160-160-160 160 56 56 64-64v168Zm40 240q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>


<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>


<script>
    /* Open */
    function openNav() {
        document.getElementById("overlayNav").style.display = "block";
    }

    /* Close */
    function closeNav() {
        document.getElementById("overlayNav").style.display = "none";
    }
</script>



<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            let codeText = '';

            // 1. Check if the codeblock contains a table (Line Numbers present)
            const tableRows = codeblock.querySelectorAll('table tr');

            if (tableRows.length > 0) {
                const lines = [];
                tableRows.forEach(row => {
                    // The actual code is in the last TD
                    const codeCell = row.lastElementChild;
                    if (codeCell) {
                        let cellText = codeCell.textContent;

                        if (cellText.endsWith('\n')) {
                            cellText = cellText.slice(0, -1);
                        }

                        lines.push(cellText);
                    }
                });
                codeText = lines.join('\n');
            } else {
                // 2. No table, use standard text extraction
                codeText = codeblock.textContent;
            }

            // 3. Copy the cleaned text to clipboard
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeText);
                copyingDone();
                return;
            }

            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = codeText;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
                console.error('Copy failed', e);
            }
            document.body.removeChild(textArea);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            // td containing LineNos
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            // table containing LineNos and code
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            // code blocks not having highlight as parent class
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script type="text/javascript" src="https://alchitry.com/elasticlunr.min.js"></script>
<script type="text/javascript" src="https://alchitry.com/search.js"></script>
<script type="module" src="https://alchitry.com/table-toggles.js"></script>
    
</body>
</html>
