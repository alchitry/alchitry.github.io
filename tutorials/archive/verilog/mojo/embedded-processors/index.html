<!DOCTYPE html>
<html lang="en" dir="auto">
<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Embedded Processors</title>


<meta name="keywords" content="keyword1, keyword2, keyword3">



<meta name="description" content="">



<meta name="author" content="Justin Rajewski">


<link rel="canonical" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;embedded-processors&#x2F;">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
</script>
<script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
</script>

<link rel="stylesheet" href="https://alchitry.com/styles.css">
<link rel="stylesheet" href="https://alchitry.com/override.css">

<link rel="icon" href="https://alchitry.com/favicon.svg" type="image/svg+xml">
<link rel="icon" type="image/png" sizes="16x16" href="https://alchitry.com/favicon_16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://alchitry.com/favicon_32.png">
<link rel="apple-touch-icon" href="https://alchitry.com/apple-touch-icon.png"><!-- 180×180 -->
<meta name="theme-color" content="#333333">


<link rel="alternate" type="application/atom+xml" title="RSS" href="https://alchitry.com/atom.xml">


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
    
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
    
</noscript>



    
</head>
<body class=" dark" id="top">
    
    
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"/>

<header class="header">

    <nav class="nav">
        <div class="logo">
            <a href="https:&#x2F;&#x2F;alchitry.com" accesskey="h" title="Alchitry (Alt + H)"><img src="https://alchitry.com/alchitry.svg"
                                                         alt="Alchitry"
                                                         aria-label="Alchitry">
            </a>
        </div>
        
        <div id="nav-search">
            <ul id="menu" class="desktop-nav">
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
                        <span>Boards</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
                        <span>News</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
                        <span>Tutorials</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
                        <span>Alchitry Labs</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
                        <span>Forum</span>
                        
                    </a>
                </li>
                
            </ul>
            <div class="search-container">
                <input class="search" type="search" placeholder="Search" autocomplete="off">
                <span class="material-symbols-outlined search-icon">search</span>

                <div class="search-results">
                    <div class="search-results__items"></div>
                </div>
            </div>
        </div>
        <div id="overlayNavOpen">
            <span onclick="openNav()" class="material-symbols-outlined">menu</span>
        </div>
        
    </nav>
</header>


<div id="overlayNav" class="overlay">
    <div class="overlay-header">
        <div class="search-container">
            <input class="search" type="search" placeholder="Search" autocomplete="off">
            <span class="material-symbols-outlined search-icon">search</span>

            <div class="search-results">
                <div class="search-results__items"></div>
            </div>
        </div>
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    </div>

    <div class="overlay-content">
        
        
        
        <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
            <span>Boards</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
            <span>News</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
            <span>Tutorials</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
            <span>Alchitry Labs</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
            <span>Forum</span>
            
        </a>
        
    </div>
</div>

    
    <main class="main">
        
<article class="post-single">
    <header class="post-header">
        <div class="breadcrumbs">
            
            <div class="breadcrumb-container">
                <a class="breadcrumb-path" href="/">Home</a>
                
                
                
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;">Tutorials</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;">Archive</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;">Verilog</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;">Mojo</a>
                
                <span class="breadcrumb-separator">»</span>
                <a class="breadcrumb-path active" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;embedded-processors&#x2F;">Embedded Processors</a>
            </div>
            
        </div>
        <h1 class="post-title">Embedded Processors</h1>
        
        
        <div class="post-meta">
            













10 min&nbsp;·&nbsp;Justin Rajewski

            &nbsp;|&nbsp;&nbsp;<a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry&#x2F;alchitry.github.io&#x2F;tree&#x2F;master/content/tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;embedded-processors.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

        </div>
        
    </header>

    
    

<div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner">
            <ul>
                
                <li>
                    <a href="#generating-the-core" aria-label="Generating the core">Generating the core</a>
                    
                </li>
                
                <li>
                    <a href="#adding-the-core-to-your-project" aria-label="Adding the core to your project">Adding the core to your project</a>
                    
                </li>
                
                <li>
                    <a href="#setting-up-xps" aria-label="Setting up XPS">Setting up XPS</a>
                    
                </li>
                
                <li>
                    <a href="#creating-the-project" aria-label="Creating the project">Creating the project</a>
                    
                </li>
                
                <li>
                    <a href="#adding-the-elf-file-to-your-project" aria-label="Adding the .elf file to your project">Adding the .elf file to your project</a>
                    
                </li>
                
                <li>
                    <a href="#editing-the-code" aria-label="Editing the code">Editing the code</a>
                    
                </li>
                
            </ul>
        </div>
    </details>
</div>


    

    
    <div class="post-content">
        <p>This tutorial is an advanced topic and is not recommend for beginners. If you want to write software in your design we recommend using the microcontroller on the Mojo before trying to embed a processor as the tools and setup can be very messy. Checkout <a href="https://alchitry.com/tutorials/archive/verilog/mojo/memory-mapping/">this tutorial</a> for more information.</p>
<p>This tutorial will outline how to add a <strong>MicroBlaze MCS</strong> to your project. The <strong>MicroBlazeMCS</strong> is a 32bit microprocessor core provided by Xilinx. It will allow you to write <strong>C/C++</strong> code that will interact with the rest of your design. While this can be very helpful in many projects, setting it up can be a bit confusing. This tutorial will hopefully demystify the process.</p>
<p>Like most tutorials here, the first step is downloading the <a href="https://github.com/embmicro/mojo-base-project/archive/master.zip">Mojo Base Project</a>.</p>
<h3 id="generating-the-core">Generating the core</h3>
<p>Go ahead and open up your fresh project in <strong>ISE</strong>.</p>
<p>Right click on somewhere in the <strong>Hierarchy</strong> panel on the left and select <strong>New Source...</strong></p>
<p>Select <strong>IP (CORE Generator &amp; Architecture Wizard)</strong> and set the <strong>File Name</strong> to <strong>microblaze_mcs</strong> and click <strong>Next</strong>.</p>
<p>Expand <strong>Embedded Processing</strong> and <strong>Processor</strong> to find <strong>MicroBlaze MCS</strong>. Choose that and click <strong>Next</strong>.</p>
<p>Click <strong>Finish</strong>.</p>
<p>The configuration wizard should now show up.</p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/coregen_microblaze.resized.png" alt="coregen_microblaze.resized.png" /></p>
<p>In the first tab, <strong>MCS</strong>, change the <strong>Input Clock Frequency</strong> to 50 since we will be running the core at 50MHz.</p>
<p>Take note of the <strong>Instance Hierarchical Design Name,</strong> it is very important later on. For now we'll just leave it at the default <strong>mcs_0</strong>.</p>
<p>Set <strong>Memory Size</strong> to <strong>16KB</strong>. The absolute minimum required for this project is <strong>8KB</strong>, but if you add any extra code, you will want a little more.</p>
<p>The <strong>Memory Size</strong> option is important because it dictates how much memory the processors has to store your code and variables. You will want to use a little memory as possible that will still fit your program since it uses valuable block RAM inside the FPGA.</p>
<p>If you look at the top of the window you will see tabs for all the different peripherals available to you.</p>
<p>In this tutorial, we will be using a timer to control how fast some LEDs blink. That means we will need a <strong>FIT</strong> (<strong>F</strong>ixed <strong>I</strong>nterval <strong>T</strong>imer) and some <strong>GPO</strong> (<strong>G</strong>eneral <strong>P</strong>urpose <strong>O</strong>utputs).</p>
<p>In the <strong>FIT</strong> tab, check the <strong>Use Timer</strong> box.</p>
<p>We want our timer to count the number of <strong>milliseconds</strong> that elapse which will allow us to create a flexible delay function. Since the Mojo uses a 50MHz clock, we want the <strong>Number of Clocks Between Strobes</strong> to be 50,000,000 / 1,000 = 50,000.</p>
<p>We will also want the timer to generate an interrupt, so check the <strong>Generate Interrupt</strong> box.</p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/coregen-fit.resized.png" alt="coregen-fit.resized.png" /></p>
<p>Head over to the <strong>GPO</strong> tab since we need some outputs for the LEDs.</p>
<p>In the <strong>General Purpose Output 1</strong> box check the box <strong>Use GPO</strong>.</p>
<p>We only have 8 LEDs, so change the <strong>Number of Bits</strong> to 8.</p>
<p>The <strong>Initial Value of GPO</strong> is fine as the default.</p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/gpo_microblaze.resized.png" alt="gpo_microblaze.resized.png" /></p>
<p>Those are the only peripherals we need for this project, but feel free to check out the other ones as they may come in handy for your own projects. If you really want to get your feet wet, head over to <a href="http://www.xilinx.com/tools/mb_mcs.htm">Xilinx's documentation</a>.</p>
<p>Click <strong>Generate</strong> to generate the core!</p>
<h3 id="adding-the-core-to-your-project">Adding the core to your project</h3>
<p>After the core is done generating (it can take a while), you should see <strong>microblaze_mcs</strong> as a file in your project.</p>
<p>We need to now instantiate this in our design. Open up <strong>mojo_top.v</strong> in your editor of choice.</p>
<p>Click on the <strong>microblaze_mcs</strong> source file and expand <strong>CORE Generator</strong> in the <strong>Processes</strong> panel. Double click on <strong>View HDL Instantiation Template</strong>. This file contains an <em>example</em> instantiation of the core. You can refer to this file to make sure you get all the port names right.</p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/instantiation_template.png" alt="instantiation_template.png" /></p>
<p>It's usually a good idea to just copy/paste it into your design and make the edits you need.</p>
<p>In our case, we need to add it to <strong>mojo_top.v</strong>. The file should look as follows.</p>
<pre data-lang="verilog" style="background-color:#282828;color:#ffffff;" class="language-verilog "><code class ="language-verilog" data-lang="verilog"><span style="font-weight:bold;color:#faac1f;">module</span><span> mojo_top</span><span style="color:#ed4343;">(
</span><span>    </span><span style="color:#969696;">// 50MHz clock input
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> clk</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#969696;">// Input from reset button (active low)
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> rst_n</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#969696;">// cclk input from AVR, high when AVR is ready
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> cclk</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#969696;">// Outputs to the 8 onboard LEDs
</span><span>    </span><span style="color:#0a8dbf;">output</span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">7</span><span style="color:#ed4343;">:</span><span style="color:#a269dc;">0</span><span style="color:#ed4343;">]</span><span>led</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#969696;">// AVR SPI connections
</span><span>    </span><span style="color:#0a8dbf;">output</span><span> spi_miso</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> spi_ss</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> spi_mosi</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> spi_sck</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#969696;">// AVR ADC channel select
</span><span>    </span><span style="color:#0a8dbf;">output </span><span style="color:#ed4343;">[</span><span style="color:#a269dc;">3</span><span style="color:#ed4343;">:</span><span style="color:#a269dc;">0</span><span style="color:#ed4343;">]</span><span> spi_channel</span><span style="color:#ed4343;">,
</span><span>    </span><span style="color:#969696;">// Serial connections
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> avr_tx</span><span style="color:#ed4343;">, </span><span style="color:#969696;">// AVR Tx =&gt; FPGA Rx
</span><span>    </span><span style="color:#0a8dbf;">output</span><span> avr_rx</span><span style="color:#ed4343;">, </span><span style="color:#969696;">// AVR Rx =&gt; FPGA Tx
</span><span>    </span><span style="color:#0a8dbf;">input</span><span> avr_rx_busy </span><span style="color:#969696;">// AVR Rx buffer full
</span><span>  </span><span style="color:#ed4343;">);
</span><span> 
</span><span>  </span><span style="color:#0a8dbf;">wire</span><span> rst </span><span style="color:#ed4343;">= ~</span><span>rst_n</span><span style="color:#ed4343;">; </span><span style="color:#969696;">// make reset active high
</span><span> 
</span><span>  </span><span style="color:#969696;">// these signals should be high-z when not used
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">assign</span><span> spi_miso </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">1&#39;bz</span><span style="color:#ed4343;">;
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">assign</span><span> avr_rx </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">1&#39;bz</span><span style="color:#ed4343;">;
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">assign</span><span> spi_channel </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">4&#39;bzzzz</span><span style="color:#ed4343;">;
</span><span> 
</span><span>  microblaze_mcs mcs_0 </span><span style="color:#ed4343;">(
</span><span>    .Clk</span><span style="color:#ed4343;">(</span><span>clk</span><span style="color:#ed4343;">), </span><span style="color:#969696;">// input Clk
</span><span>    .Reset</span><span style="color:#ed4343;">(</span><span>rst</span><span style="color:#ed4343;">), </span><span style="color:#969696;">// input Reset
</span><span>    .FIT1_Interrupt</span><span style="color:#ed4343;">(), </span><span style="color:#969696;">// output FIT1_Interrupt
</span><span>    .FIT1_Toggle</span><span style="color:#ed4343;">(), </span><span style="color:#969696;">// output FIT1_Toggle
</span><span>    .GPO1</span><span style="color:#ed4343;">(</span><span>led</span><span style="color:#ed4343;">), </span><span style="color:#969696;">// output [7 : 0] GPO1
</span><span>    .INTC_IRQ</span><span style="color:#ed4343;">() </span><span style="color:#969696;">// output INTC_IRQ
</span><span>  </span><span style="color:#ed4343;">);
</span><span> 
</span><span style="font-weight:bold;color:#faac1f;">endmodule
</span></code></pre>
<p>Notice I made the instance name <strong>mcs_0</strong>. This <strong>MUST</strong> match the name you use when you generate the core. If you don't instantiate the core at the top of your design, you must include the path in the name in CORE Gen. For example, if you have your core in a module called <strong>magic_sauce</strong> then the path would be <strong>magic_sauce/mcs_0</strong>.</p>
<p>In our design, we don't care about any of the outputs except <strong>GPO1</strong>, which is hooked up to the LEDs.</p>
<p>The last step is to run the setup script that was generated. Open the <strong>Tcl Console</strong> by clicking <strong>View-&gt;Panels-&gt;Tcl Console</strong>. In the <strong>Tcl Console</strong> tab near the bottom of ISE, enter the following line and hit enter.</p>
<pre data-lang="bash" style="background-color:#282828;color:#ffffff;" class="language-bash "><code class ="language-bash" data-lang="bash"><span style="color:#6699cc;">source ipcore_dir/microblaze_mcs_setup.tcl
</span></code></pre>
<p>It should print the following.</p>
<pre style="background-color:#282828;color:#ffffff;"><code><span>microblaze_mcs_setup: Found 1 MicroBlaze MCS core.
</span><span>microblaze_mcs_setup: Added &quot;-bm&quot; option for &quot;microblaze_mcs.bmm&quot; to ngdbuild command...
</span><span>microblaze_mcs_setup: Done.
</span></code></pre>
<p>This changes your project settings to accommodate the new core. Note that these changes don't seem to be persistent and you will likely need to run the script each time you open ISE.</p>
<p>There seems to be a bug in ISE which causes one of these settings to be wrong.</p>
<p>Right click on <strong>Implement Design</strong> in the Processes panel with <strong>mojo_top</strong> selected in the Hierarchy panel. Choose <strong>Properties</strong>.</p>
<p>Under the <strong>Other Ngdbuild Command Line Options</strong> you should see <strong>-bm &quot;ipcore_dir/microblaze_mcs.bmm&quot;</strong>. Replace that with <strong>-bm &quot;../ipcore_dir/microblaze_mcs.bmm&quot;</strong></p>
<h3 id="setting-up-xps">Setting up XPS</h3>
<p>Now we need to actually setup XPS, the IDE Xilinx provides that will compile our code.</p>
<p>When you installed ISE, you actually installed XPS too!</p>
<p>If you are using <strong>Ubuntu</strong> then you need to issue the following command because Ubuntu doesn't have a program called <strong>gmake</strong>, which is really just <strong>make</strong>.</p>
<pre data-lang="bash" style="background-color:#282828;color:#ffffff;" class="language-bash "><code class ="language-bash" data-lang="bash"><span style="color:#6699cc;">sudo ln</span><span style="color:#a269dc;"> -s</span><span style="color:#6699cc;"> /usr/bin/make /usr/bin/gmake
</span></code></pre>
<p>If you are using <strong>Linux</strong> you can create a snazzy launcher by running the following.</p>
<pre data-lang="bash" style="background-color:#282828;color:#ffffff;" class="language-bash "><code class ="language-bash" data-lang="bash"><span style="color:#6699cc;">sudo gnome-desktop-item-edit /usr/share/applications/</span><span style="color:#a269dc;"> --create-new
</span></code></pre>
<p>Under <strong>Name</strong> enter <strong>XPS SDK</strong>.</p>
<p>Under <strong>Command</strong> enter <strong>/opt/Xilinx/14.6/ISE_DS/EDK/bin/lin64/xsdk</strong>, note that your version of ISE may vary.</p>
<p>You can find an icon at <strong>/opt/Xilinx/14.6/ISE_DS/EDK/eclipse/lin64/eclipse/plugins/com.xilinx.sdk.product_1.0.0/icons/xps_sdk_32.png</strong></p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/launcher.png" alt="" /></p>
<p>Once you have <strong>XPS</strong> open, there are a few hoops to jump through before the coding can begin.</p>
<h3 id="creating-the-project">Creating the project</h3>
<p>Click <strong>File-&gt;New-&gt;Other...</strong></p>
<p>Under <strong>Xilinx</strong> choose <strong>Hardware Platform Specification</strong> and click <strong>Next</strong>.</p>
<p>Enter <strong>MojoDemo</strong> as the <strong>Project Name</strong>. Note that you can't have spaces in your project names.</p>
<p>Under <strong>Target Hardware Specification</strong> click <strong>Browse...</strong> and navigate to the <strong>ipcore_dir</strong>. Select <strong>microblaze_mcs_sdk.xml</strong>.</p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/xps_hardware_project.resized.png" alt="xps_hardware_project.resized.png" /></p>
<p>Click <strong>Finish</strong>.</p>
<p>Now you can create a project for your actual code. Click <strong>File-&gt;New-&gt;Other...</strong> and choose <strong>Application Project</strong> under <strong>Xilinx</strong>.</p>
<p>Under <strong>Project Name</strong> enter <strong>LED_Controller</strong>.</p>
<p>Make sure that <strong>Hardware Platform</strong> is set to <strong>MojoDemo</strong> and the processor is <strong>microblaze_mcs</strong>.</p>
<p>Under <strong>Target Software</strong> make sure the <strong>OS Platform</strong> is set to <strong>standalone</strong>, <strong>Language</strong> is set to <strong>C</strong>, and <strong>Board Support Package</strong> is set to <strong>Create New -&gt; LED_Controller_bsp</strong>.</p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/xps_app_project.png" alt="xps_app_project.png" /></p>
<p>Click <strong>Next</strong>.</p>
<p>Choose <strong>Empty Application</strong> for a <strong>Template</strong> and click <strong>Finish</strong>.</p>
<p>Open the project folder on the left for your project, <strong>LED_Controller</strong>. Right click the <strong>src</strong> folder and choose <strong>New-&gt;Source File</strong>. Enter <strong>LEDBlinker.c</strong> as the file name and click <strong>Finish</strong>.</p>
<p>Open the new file and paste in the following code.</p>
<pre data-lang="c" style="background-color:#282828;color:#ffffff;" class="language-c "><code class ="language-c" data-lang="c"><span style="font-weight:bold;color:#0abfbf;">#include </span><span style="color:#77bf0a;">&lt;xparameters.h&gt;
</span><span style="font-weight:bold;color:#0abfbf;">#include </span><span style="color:#77bf0a;">&lt;xiomodule.h&gt;
</span><span> 
</span><span>XIOModule gpo;
</span><span style="color:#ed4343;">volatile</span><span> u32 ct </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">0</span><span>;
</span><span> 
</span><span style="color:#0a8dbf;">void </span><span style="color:#6699cc;">timerTick</span><span>(</span><span style="color:#0a8dbf;">void</span><span style="color:#ed4343;">* </span><span style="color:#a269dc;">ref</span><span>) {
</span><span>  ct</span><span style="color:#ed4343;">++</span><span>; </span><span style="color:#969696;">// increase ct every millisecond
</span><span>}
</span><span> 
</span><span style="color:#0a8dbf;">void </span><span style="color:#6699cc;">delay</span><span>(u32 </span><span style="color:#a269dc;">ms</span><span>) {
</span><span>  ct </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">0</span><span>; </span><span style="color:#969696;">// set the counter to 0
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">while </span><span>(ct </span><span style="color:#ed4343;">&lt;</span><span> ms) </span><span style="color:#969696;">// wait for ms number of milliseconds
</span><span>    ;
</span><span>}
</span><span> 
</span><span style="color:#0a8dbf;">int </span><span style="color:#6699cc;">main</span><span>() {
</span><span>  </span><span style="color:#6699cc;">XIOModule_Initialize(</span><span style="color:#ed4343;">&amp;</span><span style="color:#6699cc;">gpo, XPAR_IOMODULE_0_DEVICE_ID)</span><span>; </span><span style="color:#969696;">// Initialize the GPO module
</span><span> 
</span><span>  </span><span style="color:#6699cc;">microblaze_register_handler(XIOModule_DeviceInterruptHandler,
</span><span style="color:#6699cc;">                              XPAR_IOMODULE_0_DEVICE_ID)</span><span>; </span><span style="color:#969696;">// register the interrupt handler
</span><span> 
</span><span>  </span><span style="color:#6699cc;">XIOModule_Start(</span><span style="color:#ed4343;">&amp;</span><span style="color:#6699cc;">gpo)</span><span>; </span><span style="color:#969696;">// start the GPO module
</span><span> 
</span><span>  </span><span style="color:#6699cc;">XIOModule_Connect(</span><span style="color:#ed4343;">&amp;</span><span style="color:#6699cc;">gpo, XIN_IOMODULE_FIT_1_INTERRUPT_INTR, timerTick,
</span><span style="color:#6699cc;">                    </span><span style="color:#a269dc;">NULL</span><span style="color:#6699cc;">)</span><span>; </span><span style="color:#969696;">// register timerTick() as our interrupt handler
</span><span>  </span><span style="color:#6699cc;">XIOModule_Enable(</span><span style="color:#ed4343;">&amp;</span><span style="color:#6699cc;">gpo, XIN_IOMODULE_FIT_1_INTERRUPT_INTR)</span><span>; </span><span style="color:#969696;">// enable the interrupt
</span><span> 
</span><span>  </span><span style="color:#6699cc;">microblaze_enable_interrupts()</span><span>; </span><span style="color:#969696;">// enable global interrupts
</span><span> 
</span><span>  u8 leds </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">0</span><span>;
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">while </span><span>(</span><span style="color:#a269dc;">1</span><span>) {
</span><span>    </span><span style="color:#969696;">// write the LED value to port 1 (you can have up to 4 ports)
</span><span>    </span><span style="color:#6699cc;">XIOModule_DiscreteWrite(</span><span style="color:#ed4343;">&amp;</span><span style="color:#6699cc;">gpo, </span><span style="color:#a269dc;">1</span><span style="color:#6699cc;">, leds</span><span style="color:#ed4343;">++</span><span style="color:#6699cc;">)</span><span>;
</span><span>    </span><span style="color:#6699cc;">delay(</span><span style="color:#a269dc;">1000</span><span style="color:#6699cc;">)</span><span>; </span><span style="color:#969696;">// delay one second
</span><span>  }
</span><span>}
</span></code></pre>
<p>This code works by first initalizing the GPO module, fixed-interval timer, and interrupts. The fixed-interval timer is setup to fire an interrupt every millisecond which will call our interrupt handler, <strong>timerTick</strong>. Each time <strong>timerTick</strong> is called, it increments a global variable <strong>ct</strong>. The <strong>delay</strong> function uses <strong>ct</strong> to delay for specified number of milliseconds.</p>
<p>It is worth looking at the other templates when you create a project to get an idea of some other functions you can use.</p>
<p>Find the hammer icon on the top tool bar to build the project and generate an <strong>.elf</strong> file. This is the file that tells ISE how to program the processor.</p>
<h3 id="adding-the-elf-file-to-your-project">Adding the .elf file to your project</h3>
<p>There is one last command to run to finish the project setup.</p>
<p>Back in ISE, go to the <strong>Tcl Console</strong> again and enter the following command.</p>
<pre data-lang="bash" style="background-color:#282828;color:#ffffff;" class="language-bash "><code class ="language-bash" data-lang="bash"><span style="color:#6699cc;">microblaze_mcs_data2mem /path/to/project/LED_Controller/Debug/LED_Controller.elf
</span></code></pre>
<p>Note that you will have to replace <strong>/path/to/project</strong> with your actual path.</p>
<p>It should output something similar to the following.</p>
<pre style="background-color:#282828;color:#ffffff;"><code><span>microblaze_mcs_data2mem: Found 1 MicroBlaze MCS core.
</span><span>microblaze_mcs_data2mem: Using &quot;LED_Controller.elf&quot; for microblaze_mcs
</span><span>microblaze_mcs_data2mem: Added &quot;-bd&quot; options to bitgen command line.
</span><span>microblaze_mcs_data2mem: Running &quot;data2mem&quot; to create simulation files.
</span><span>microblaze_mcs_data2mem: Bitstream does not exist. Not running &quot;data2mem&quot; to update...
</span><span>microblaze_mcs_data2mem: Done.
</span></code></pre>
<p>You can now double click <strong>Generate Programming File</strong> to generate a <strong>.bin</strong> file that you can load onto your Mojo.</p>
<p>If all went well you should now see the LEDs counting the seconds.</p>
<h3 id="editing-the-code">Editing the code</h3>
<p>If you want to edit the code in <strong>XPS</strong> all you have to do after building the project is re-run the <strong>Generate Programming File</strong> stage in ISE to update the <strong>.bin</strong> file. You don't need to re-run <strong>Synthesize</strong> nor <strong>Implement Design</strong>.</p>

    </div>
    

    <footer class="post-footer">
        

        
        



<nav class="paginav">
    
        
        <a class="prev" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;sdram&#x2F;">
            <span class="title">« Prev</span>
            <br>
            <span>SDRAM</span>
        </a>
        
        
    
</nav>


        
        
    </footer>

</article>

    </main>
    
    <footer class="footer">
    <div>
        <div class="social-icons">
    
    <a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="GitHub">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;youtube.com&#x2F;c&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="YouTube">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z">
    </path>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;atom.xml" target="_blank" rel="noopener noreferrer me" title="RSS">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>


    </a>
    
</div>

        <span>&copy; 2026 <a href="https:&#x2F;&#x2F;alchitry.com">Alchitry</a></span>
    </div>
</footer>


<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#e3e3e3"><path d="M440-320h80v-168l64 64 56-56-160-160-160 160 56 56 64-64v168Zm40 240q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>


<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>


<script>
    /* Open */
    function openNav() {
        document.getElementById("overlayNav").style.display = "block";
    }

    /* Close */
    function closeNav() {
        document.getElementById("overlayNav").style.display = "none";
    }
</script>



<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            let codeText = '';

            // 1. Check if the codeblock contains a table (Line Numbers present)
            const tableRows = codeblock.querySelectorAll('table tr');

            if (tableRows.length > 0) {
                const lines = [];
                tableRows.forEach(row => {
                    // The actual code is in the last TD
                    const codeCell = row.lastElementChild;
                    if (codeCell) {
                        let cellText = codeCell.textContent;

                        if (cellText.endsWith('\n')) {
                            cellText = cellText.slice(0, -1);
                        }

                        lines.push(cellText);
                    }
                });
                codeText = lines.join('\n');
            } else {
                // 2. No table, use standard text extraction
                codeText = codeblock.textContent;
            }

            // 3. Copy the cleaned text to clipboard
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeText);
                copyingDone();
                return;
            }

            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = codeText;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
                console.error('Copy failed', e);
            }
            document.body.removeChild(textArea);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            // td containing LineNos
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            // table containing LineNos and code
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            // code blocks not having highlight as parent class
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script type="text/javascript" src="https://alchitry.com/elasticlunr.min.js"></script>
<script type="text/javascript" src="https://alchitry.com/search.js"></script>
<script type="module" src="https://alchitry.com/table-toggles.js"></script>
    
</body>
</html>
