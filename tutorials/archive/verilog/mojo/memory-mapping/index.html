<!DOCTYPE html>
<html lang="en" dir="auto">
<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Memory Mapping</title>


<meta name="keywords" content="keyword1, keyword2, keyword3">



<meta name="description" content="">



<meta name="author" content="Justin Rajewski">


<link rel="canonical" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;memory-mapping&#x2F;">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
</script>
<script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
</script>

<link rel="stylesheet" href="https://alchitry.com/styles.css">
<link rel="stylesheet" href="https://alchitry.com/override.css">

<link rel="icon" href="https://alchitry.com/favicon.svg" type="image/svg+xml">
<link rel="icon" type="image/png" sizes="16x16" href="https://alchitry.com/favicon_16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://alchitry.com/favicon_32.png">
<link rel="apple-touch-icon" href="https://alchitry.com/apple-touch-icon.png"><!-- 180×180 -->
<meta name="theme-color" content="#333333">


<link rel="alternate" type="application/atom+xml" title="RSS" href="https://alchitry.com/atom.xml">


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
    
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
    
</noscript>



    
</head>
<body class=" dark" id="top">
    
    
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"/>

<header class="header">

    <nav class="nav">
        <div class="logo">
            <a href="https:&#x2F;&#x2F;alchitry.com" accesskey="h" title="Alchitry (Alt + H)"><img src="https://alchitry.com/alchitry.svg"
                                                         alt="Alchitry"
                                                         aria-label="Alchitry">
            </a>
        </div>
        
        <div id="nav-search">
            <ul id="menu" class="desktop-nav">
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
                        <span>Boards</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
                        <span>News</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
                        <span>Tutorials</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
                        <span>Alchitry Labs</span>
                        
                    </a>
                </li>
                
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
                        <span>Forum</span>
                        
                    </a>
                </li>
                
            </ul>
            <div class="search-container">
                <input class="search" type="search" placeholder="Search" autocomplete="off">
                <span class="material-symbols-outlined search-icon">search</span>

                <div class="search-results">
                    <div class="search-results__items"></div>
                </div>
            </div>
        </div>
        <div id="overlayNavOpen">
            <span onclick="openNav()" class="material-symbols-outlined">menu</span>
        </div>
        
    </nav>
</header>


<div id="overlayNav" class="overlay">
    <div class="overlay-header">
        <div class="search-container">
            <input class="search" type="search" placeholder="Search" autocomplete="off">
            <span class="material-symbols-outlined search-icon">search</span>

            <div class="search-results">
                <div class="search-results__items"></div>
            </div>
        </div>
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    </div>

    <div class="overlay-content">
        
        
        
        <a href="https:&#x2F;&#x2F;shop.alchitry.com&#x2F;collections&#x2F;products" title="Boards">
            <span>Boards</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;news" title="News">
            <span>News</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials" title="Tutorials">
            <span>Tutorials</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;alchitry-labs" title="Alchitry Labs">
            <span>Alchitry Labs</span>
            
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;forum.alchitry.com" title="Forum">
            <span>Forum</span>
            
        </a>
        
    </div>
</div>

    
    <main class="main">
        
<article class="post-single">
    <header class="post-header">
        <div class="breadcrumbs">
            
            <div class="breadcrumb-container">
                <a class="breadcrumb-path" href="/">Home</a>
                
                
                
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;">Tutorials</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;">Archive</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;">Verilog</a>
                
                
                <span class="breadcrumb-separator">»</span>
                
                <a class="breadcrumb-path" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;">Mojo</a>
                
                <span class="breadcrumb-separator">»</span>
                <a class="breadcrumb-path active" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;memory-mapping&#x2F;">Memory Mapping</a>
            </div>
            
        </div>
        <h1 class="post-title">Memory Mapping</h1>
        
        
        <div class="post-meta">
            













9 min&nbsp;·&nbsp;Justin Rajewski

            &nbsp;|&nbsp;&nbsp;<a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry&#x2F;alchitry.github.io&#x2F;tree&#x2F;master/content/tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;memory-mapping.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

        </div>
        
    </header>

    
    

<div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner">
            <ul>
                
                <li>
                    <a href="#memory-mapped-io-in-processors" aria-label="Memory mapped IO in processors">Memory mapped IO in processors</a>
                    
                </li>
                
                <li>
                    <a href="#memory-mapping-the-fpga" aria-label="Memory mapping the FPGA">Memory mapping the FPGA</a>
                    
                </li>
                
                <li>
                    <a href="#the-fpga-side-of-things" aria-label="The FPGA side of things">The FPGA side of things</a>
                    
                    <ul>
                    
                        <li>
                            <a href="#defining-the-addresses" aria-label="Defining the addresses">Defining the addresses</a>
                            
                        </li>
                    
                    </ul>
                    
                </li>
                
                <li>
                    <a href="#the-arduino-side-of-things" aria-label="The Arduino side of things">The Arduino side of things</a>
                    
                    <ul>
                    
                        <li>
                            <a href="#avr-flags" aria-label="AVR Flags">AVR Flags</a>
                            
                        </li>
                    
                        <li>
                            <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                            
                        </li>
                    
                    </ul>
                    
                </li>
                
            </ul>
        </div>
    </details>
</div>


    

    
    <div class="post-content">
        <p>This tutorial covers a common technique for interfacing a peripheral to a processor known as <strong>memory mapping</strong>. Memory mapping is were you break out a set of functions or settings and map them to a set of values that are selected by a given address. Typically the master is able to read and write these values however it chooses much like a block of RAM. However, these values aren't just blocks of memory, they effect some external device. Because this is used for interfacing it is sometimes called <strong>memory mapped IO</strong>.</p>
<h3 id="memory-mapped-io-in-processors">Memory mapped IO in processors</h3>
<p>The most common place you see memory mapped IO is inside a processor. Actually, if you've ever programmed an Arduino or other microcontroller, chances are you have already been exposed to this technique.</p>
<p>A great example is the <strong>PORT</strong> registers of an ATmega microcontroller (the ones used by Arduino). When you write code for these processors you can write something like the following.</p>
<pre data-lang="c" style="background-color:#282828;color:#ffffff;" class="language-c "><code class ="language-c" data-lang="c"><span>PORTB </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">0xAA</span><span>;
</span></code></pre>
<p>This will set the 8 IO pins designated to <strong>PORTB</strong> to the value 0xAA. However, in your code <strong>PORTB</strong> is actually just a macro and is really a pointer to a special memory address. This address in memory doesn't simply map to RAM but also maps to an IO peripheral that takes the value and outputs it to the IO pins.</p>
<p>Without memory mapped IO, the microcontroller would have no way to input or output any data!</p>
<p>This example of an IO port is very simple, but the devices that are memory mapped can literally be anything. Pretty much all processors use this technique, including your computer. Everything in your computer is memory mapped to the CPU. When you install a driver on your computer, you are installing the piece of code responsible for reading and writing values to these special memory locations to make the device work.</p>
<h3 id="memory-mapping-the-fpga">Memory mapping the FPGA</h3>
<p>The microcontroller on the Mojo doesn't have an external RAM interface so we can't map the FPGA directly to its memory space. However, the FPGA is connected over an SPI bus and we can use that!</p>
<p>Before we dive into how we are going to do this, download the two demo projects for this tutorial.</p>
<ul>
<li>
<p><a href="http://cdn.embeddedmicro.com/mem_map/Mojo-Arduino.zip">FPGA Project</a></p>
</li>
<li>
<p><a href="http://cdn.embeddedmicro.com/mem_map/mojo_mem_map.zip">Arduino Project</a></p>
</li>
</ul>
<p>This tutorial is a little bit different from the rest of the tutorials in that these two projects are already ready to go. You don't have to make any modifications before building them. This is because this tutorial is not to show how cool it is to make some LEDs blink (it's super cool I know), but rather as a starting point for interfacing the FPGA and Arduino together. I recommend downloading these two projects every time you want to start a new project that interfaces the two devices and start modifying it.</p>
<h2 id="the-fpga-side-of-things">The FPGA side of things</h2>
<p>In the FPGA project, open up <strong>mojo_top.v</strong> and take a look at the basic setup. There are two modules instantiated, <strong>avr_interface</strong> and <strong>reg_ctrl</strong>.</p>
<p><strong>avr_interface</strong> is responsible for all the communications with the Arduino (AVR, ATmega, and Arduino are basically the same in this context). This is a modified version of the module found in the base project. It has been modified to provide a basic register interface over SPI instead of allowing the FPGA to read the ADC ports. You should also note that the pins that used to be <strong>adc_channel</strong> are now <strong>avr_flags</strong>. These will be covered in detail more later.</p>
<p>You can open up <strong>avr_interface</strong> to checkout how the register interface is implemented. The basic protocol is as follows.</p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/mem_map_write.png" alt="mem_map_write.png" /></p>
<p><img src="https://cdn.alchitry.com/verilog/mojo/mem_map_read.png" alt="mem_map_read.png" /></p>
<p>The transfer starts by the AVR pulling <strong>CS</strong> (<strong>C</strong>hip <strong>S</strong>elect) low. The first byte sent specifies what type of transfer (read or write), if the address is auto-incremented, and the address. The following bytes are the values that are read or written to the corresponding addresses. If <strong>inc</strong> is 1, B1 is from <strong>addr</strong>, B2 is from <strong>addr + 1</strong>, and Bn is from <strong>addr + n - 1</strong>. If <strong>inc</strong> is 0, then the same address is read or written multiple times. If the transfer is for a single address, <strong>inc</strong> doesn't make a difference. A transfer is terminated by <strong>CS</strong> going high.</p>
<p>For example, to write 0xAA to address 0x00, we would send 0x80 (write address 0) followed by 0xAA. To write 0xAA to address 0 and 0xBB to address 1, we would send 0xC0 (write, auto-inc, address 0), 0xAA, 0xBB. It's the same pattern for reads except the values are read on <strong>MISO</strong> instead of written to <strong>MOSI</strong>.</p>
<p>You don't really have to really worry about this protocol since the example code covers both ends of the communication. You simply specify the address and values. However, it is useful to know so you can write your own mutli-byte transfer functions using auto-inc for efficiency.</p>
<h3 id="defining-the-addresses">Defining the addresses</h3>
<p>All the address definitions are in the the module <strong>reg_ctrl</strong>. Open up <strong>reg_ctrl.v</strong> and take a look.</p>
<p>The demo code only has one valid address, address 0. That address is used to read the write values to the LEDs.</p>
<pre data-lang="verilog" style="background-color:#282828;color:#ffffff;" class="language-verilog "><code class ="language-verilog" data-lang="verilog"><span style="font-weight:bold;color:#0abfbf;">if </span><span style="color:#ed4343;">(</span><span>new_req</span><span style="color:#ed4343;">) </span><span style="font-weight:bold;color:#0abfbf;">begin
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">if </span><span style="color:#ed4343;">(</span><span>write</span><span style="color:#ed4343;">)
</span><span>    </span><span style="font-weight:bold;color:#0abfbf;">case </span><span style="color:#ed4343;">(</span><span>reg_addr</span><span style="color:#ed4343;">)
</span><span>      </span><span style="color:#a269dc;">6&#39;h00</span><span style="color:#ed4343;">:</span><span> led_d </span><span style="color:#ed4343;">=</span><span> write_value</span><span style="color:#ed4343;">;
</span><span>    </span><span style="font-weight:bold;color:#0abfbf;">endcase
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">else </span><span style="color:#969696;">//read
</span><span>    </span><span style="font-weight:bold;color:#0abfbf;">case </span><span style="color:#ed4343;">(</span><span>reg_addr</span><span style="color:#ed4343;">)
</span><span>      </span><span style="color:#a269dc;">6&#39;h00</span><span style="color:#ed4343;">:</span><span> read_value_d </span><span style="color:#ed4343;">=</span><span> led_q</span><span style="color:#ed4343;">;
</span><span>    </span><span style="font-weight:bold;color:#0abfbf;">endcase
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">end
</span></code></pre>
<p>This block of code is what actually makes address 0 correspond to the LEDs. There is a group of flip-flops <strong>led_d/q</strong> that are connected to the LEDs. When the address is 0 and it's a write, the value of this flip-flop is updated with the <strong>write_value</strong>. When the address is 0 and it's a read, the <strong>read_value_d/q</strong> flip-flops are set to the value of <strong>led_q</strong>. Those flip-flops provide the data for the next SPI transfer. Since the FPGA is clocked at 50MHz and the SPI bus is substantially slower at 4MHz, the FPGA has a few clock cycles to prepare the read data before it is needed. This can be helpful if your read can't be done instantly, unlike this case.</p>
<h2 id="the-arduino-side-of-things">The Arduino side of things</h2>
<p>In the Arduino project, the code for the demo is pretty short and simple.</p>
<p>First take a look at the <strong>registers.h</strong> file. In this file I defined <strong>LED_REG</strong> to be the address of the LEDs, or 0x00. Using this file to define all the address in your design will make it much easier if you ever need to move things around.</p>
<p>Now take a look at <strong>fpga_interface</strong> as shown below.</p>
<pre data-lang="c" style="background-color:#282828;color:#ffffff;" class="language-c "><code class ="language-c" data-lang="c"><span style="color:#0a8dbf;">void </span><span style="color:#6699cc;">writeReg</span><span>(</span><span style="color:#fac863;">uint8_t </span><span style="color:#a269dc;">addr</span><span>, </span><span style="color:#fac863;">uint8_t </span><span style="color:#a269dc;">value</span><span>){
</span><span>  </span><span style="color:#6699cc;">SET(SS, LOW)</span><span>;
</span><span>  SPI.</span><span style="color:#6699cc;">transfer(</span><span style="color:#a269dc;">0x80</span><span style="color:#ed4343;">|</span><span style="color:#6699cc;">(addr</span><span style="color:#ed4343;">&amp;</span><span style="color:#a269dc;">0x3F</span><span style="color:#6699cc;">))</span><span>;
</span><span>  SPI.</span><span style="color:#6699cc;">transfer(value)</span><span>;
</span><span>  </span><span style="color:#6699cc;">SET(SS, HIGH)</span><span>;
</span><span>}
</span><span> 
</span><span style="color:#fac863;">uint8_t </span><span style="color:#6699cc;">readReg</span><span>(</span><span style="color:#fac863;">uint8_t </span><span style="color:#a269dc;">addr</span><span>){
</span><span>  </span><span style="color:#6699cc;">SET(SS, LOW)</span><span>;
</span><span>  SPI.</span><span style="color:#6699cc;">transfer(</span><span style="color:#a269dc;">0x00</span><span style="color:#ed4343;">|</span><span style="color:#6699cc;">(addr</span><span style="color:#ed4343;">&amp;</span><span style="color:#a269dc;">0x3F</span><span style="color:#6699cc;">))</span><span>;
</span><span>  </span><span style="color:#fac863;">uint8_t</span><span> v </span><span style="color:#ed4343;">=</span><span> SPI.</span><span style="color:#6699cc;">transfer(</span><span style="color:#a269dc;">0xff</span><span style="color:#6699cc;">)</span><span>;
</span><span>  </span><span style="color:#6699cc;">SET(SS, HIGH)</span><span>;
</span><span>  </span><span style="font-weight:bold;color:#0abfbf;">return</span><span> v;
</span><span>}
</span></code></pre>
<p>These two functions implement the basic protocol outlined earlier. They only allow for transfers of a single byte and don't use the auto-inc signal at all. If you need to read or write many addresses you should add your own functions in this file that can effienctly interface with your FPGA design.</p>
<p>Now for the brains of the operation. Take a look at the main file, <strong>mojo_mem_map</strong>. Most of the code in this file is just used for loading the FPGA, however, the functions <strong>userLoop()</strong> and <strong>userInit()</strong> are your's to mess with. It's important to try and keep the <strong>userLoop()</strong> execution time low (no while(1) loops) so that the Mojo Loader can get the Mojo's attention before it times out. If it does timeout, a quick retry usually will be enough to get it to work.</p>
<pre data-linenos data-lang="c" style="background-color:#282828;color:#ffffff;" class="language-c "><code class ="language-c" data-lang="c"><table><tbody><tr><td>30</td><td><span style="color:#0a8dbf;">void </span><span style="color:#6699cc;">userLoop</span><span>() {
</span></td></tr><tr><td>31</td><td><span>  </span><span style="color:#ed4343;">static </span><span style="color:#0a8dbf;">unsigned long</span><span> time </span><span style="color:#ed4343;">= </span><span style="color:#a269dc;">0</span><span>;
</span></td></tr><tr><td>32</td><td><span> 
</span></td></tr><tr><td>33</td><td><span>  </span><span style="font-weight:bold;color:#0abfbf;">if </span><span>(time </span><span style="color:#ed4343;">== </span><span style="color:#a269dc;">0</span><span>)
</span></td></tr><tr><td>34</td><td><span>    time </span><span style="color:#ed4343;">= </span><span style="color:#6699cc;">millis()</span><span>;
</span></td></tr><tr><td>35</td><td><span> 
</span></td></tr><tr><td>36</td><td><span>  </span><span style="color:#0a8dbf;">long</span><span> curTime </span><span style="color:#ed4343;">= </span><span style="color:#6699cc;">millis()</span><span>;
</span></td></tr><tr><td>37</td><td><span>  </span><span style="color:#969696;">// use millis to determin the elapsed time insted of using delay() becuase
</span></td></tr><tr><td>38</td><td><span>  </span><span style="color:#969696;">// this will allow the Mojo to stay responsive to the Mojo Loader
</span></td></tr><tr><td>39</td><td><span> 
</span></td></tr><tr><td>40</td><td><span>  </span><span style="color:#969696;">// if 100ms have elapsed write to the LEDs
</span></td></tr><tr><td>41</td><td><span>  </span><span style="font-weight:bold;color:#0abfbf;">if </span><span>(curTime </span><span style="color:#ed4343;">&gt;</span><span> time </span><span style="color:#ed4343;">+ </span><span style="color:#a269dc;">100</span><span>) { 
</span></td></tr><tr><td>42</td><td><span>    </span><span style="color:#fac863;">uint8_t</span><span> leds </span><span style="color:#ed4343;">= </span><span style="color:#6699cc;">readReg(LED_REG) </span><span style="color:#ed4343;">+ </span><span style="color:#a269dc;">1</span><span>;
</span></td></tr><tr><td>43</td><td><span>    </span><span style="color:#6699cc;">writeReg(LED_REG, leds)</span><span>;
</span></td></tr><tr><td>44</td><td><span> 
</span></td></tr><tr><td>45</td><td><span>    time </span><span style="color:#ed4343;">=</span><span> curTime;
</span></td></tr><tr><td>46</td><td><span>  }
</span></td></tr><tr><td>47</td><td><span>}
</span></td></tr></tbody></table></code></pre>
<p>This demo code simply reads the value of the LED address and adds one to it. That new value is written back to the LED address. This happens every 100ms thanks the <strong>millis()</strong> function. The <strong>delay()</strong> function isn't used because that would block execution and delay the Mojo from entering loading mode when requested. In this case a 100ms delay really wouldn't hurt anything, but this is shown as a best practice.</p>
<p>If you load the FPGA and the Arduino with the demo code, the LEDs should start counting up.</p>
<h3 id="avr-flags">AVR Flags</h3>
<p>There are four signals named <strong>avr_flags</strong> that are just general purpose pins that connect the FPGA and AVR. These are great when the AVR is waiting for the FPGA to do something, or for the FPGA to get the AVR's attention. They are configured as inputs to the AVR (outputs of the FPGA) in the demo project.</p>
<p>They can be hooked up anywhere in your design to signal the status of some process.</p>
<p>To read the flags on the AVR you can use code like this.</p>
<pre data-linenos data-lang="c" style="background-color:#282828;color:#ffffff;" class="language-c "><code class ="language-c" data-lang="c"><table><tbody><tr><td>191</td><td><span style="color:#fac863;">uint8_t</span><span> flags </span><span style="color:#ed4343;">= </span><span>(FLAGS_PIN </span><span style="color:#ed4343;">&amp;</span><span> FLAGS_MASK) </span><span style="color:#ed4343;">&gt;&gt;</span><span> FLAGS_OFFSET;
</span></td></tr><tr><td>192</td><td><span style="font-weight:bold;color:#0abfbf;">if </span><span>(flags </span><span style="color:#ed4343;">&amp; </span><span style="color:#a269dc;">0x01</span><span>) {
</span></td></tr><tr><td>193</td><td><span>  </span><span style="color:#969696;">// flag 1 is set!
</span></td></tr><tr><td>194</td><td><span>}
</span></td></tr></tbody></table></code></pre>
<p><strong>flags</strong> holds the value of all four flags so you can test for each one individually or some combination.</p>
<h3 id="conclusion">Conclusion</h3>
<p>So what can you use this for? You can basically turn the FPGA into any peripheral you can imagine for your Arduino projects. For a more advanced example on how to use this in your own projects, check out the <a href="https://alchitry.com/tutorials/projects/hexapod/">hexapod</a> which uses this extensively. The FPGA in this project basically becomes a servo controller and a blob detection sensor. The Arduino code doesn't have to know anything about the camera, it just receives blobs that are detected in the images.</p>

    </div>
    

    <footer class="post-footer">
        

        
        



<nav class="paginav">
    
        
        <a class="prev" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;using-core-generator&#x2F;">
            <span class="title">« Prev</span>
            <br>
            <span>Using Core Generator</span>
        </a>
        
        
        <a class="next" href="https:&#x2F;&#x2F;alchitry.com&#x2F;tutorials&#x2F;archive&#x2F;verilog&#x2F;mojo&#x2F;sdram&#x2F;">
            <span class="title">Next »</span>
            <br>
            <span>SDRAM</span>
        </a>
        
    
</nav>


        
        
    </footer>

</article>

    </main>
    
    <footer class="footer">
    <div>
        <div class="social-icons">
    
    <a href="https:&#x2F;&#x2F;github.com&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="GitHub">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;youtube.com&#x2F;c&#x2F;alchitry" target="_blank" rel="noopener noreferrer me" title="YouTube">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z">
    </path>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
</svg>


    </a>
    
    <a href="https:&#x2F;&#x2F;alchitry.com&#x2F;atom.xml" target="_blank" rel="noopener noreferrer me" title="RSS">
        

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>


    </a>
    
</div>

        <span>&copy; 2026 <a href="https:&#x2F;&#x2F;alchitry.com">Alchitry</a></span>
    </div>
</footer>


<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#e3e3e3"><path d="M440-320h80v-168l64 64 56-56-160-160-160 160 56 56 64-64v168Zm40 240q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>


<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>


<script>
    /* Open */
    function openNav() {
        document.getElementById("overlayNav").style.display = "block";
    }

    /* Close */
    function closeNav() {
        document.getElementById("overlayNav").style.display = "none";
    }
</script>



<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            let codeText = '';

            // 1. Check if the codeblock contains a table (Line Numbers present)
            const tableRows = codeblock.querySelectorAll('table tr');

            if (tableRows.length > 0) {
                const lines = [];
                tableRows.forEach(row => {
                    // The actual code is in the last TD
                    const codeCell = row.lastElementChild;
                    if (codeCell) {
                        let cellText = codeCell.textContent;

                        if (cellText.endsWith('\n')) {
                            cellText = cellText.slice(0, -1);
                        }

                        lines.push(cellText);
                    }
                });
                codeText = lines.join('\n');
            } else {
                // 2. No table, use standard text extraction
                codeText = codeblock.textContent;
            }

            // 3. Copy the cleaned text to clipboard
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeText);
                copyingDone();
                return;
            }

            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = codeText;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
                console.error('Copy failed', e);
            }
            document.body.removeChild(textArea);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            // td containing LineNos
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            // table containing LineNos and code
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            // code blocks not having highlight as parent class
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script type="text/javascript" src="https://alchitry.com/elasticlunr.min.js"></script>
<script type="text/javascript" src="https://alchitry.com/search.js"></script>
<script type="module" src="https://alchitry.com/table-toggles.js"></script>
    
</body>
</html>
